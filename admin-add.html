<h1></h1>

<div class="card">
  <form id="addProductForm">
    <div class="form-group">
      <label for="name">Product Name</label>
      <input type="text" id="name" placeholder="Enter product name" required />
    </div>

    <div class="form-group">
      <label for="price">Price (₱)</label>
      <input type="number" id="price" placeholder="Enter price" step="0.01" min="0" required />
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <textarea id="description" placeholder="Enter product description" required></textarea>
    </div>

    <div class="form-group">
      <label for="stock">Stock</label>
      <input type="number" id="stock" placeholder="Enter stock quantity" min="0" required />
    </div>

    <div class="form-group">
      <label for="imageUrl">Image URL</label>
      <input type="url" id="imageUrl" placeholder="https://example.com/product.jpg" required />
    </div>

    <button type="submit" id="submitBtn">➕ Add Product</button>
  </form>
</div>

<style>
  body {
    background: radial-gradient(120% 120% at 0% 0%, #0b0c0f, #111318);
    color: #e7e9ea;
    font-family: system-ui, sans-serif;
  }
  h1 {
    margin-bottom: 16px;
    color: #c7b7ff;
  }
  .card {
    background: rgba(28, 25, 43, 0.95);
    padding: 24px;
    border-radius: 16px;
    box-shadow: 0 8px 24px rgba(0,0,0,.45);
    max-width: 500px;
  }
  .form-group {
    margin-bottom: 16px;
    display: flex;
    flex-direction: column;
  }
  label {
    font-size: 14px;
    margin-bottom: 6px;
    color: #c7b7ff;
  }
  input, textarea {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #444;
    background: #1f1f2e;
    color: #e7e9ea;
    font-size: 14px;
    transition: border-color .2s ease;
  }
  input:focus, textarea:focus {
    outline: none;
    border-color: #7c3aed;
  }
  textarea {
    min-height: 80px;
    resize: vertical;
  }
  button {
    background: linear-gradient(90deg, #7c3aed, #4c1d95);
    color: #fff;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    width: 100%;
    transition: opacity .2s ease;
  }
  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
</style>

<script type="module">
  import { app, db } from "./auth.js";
  import { collection, addDoc, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

  const form = document.getElementById("addProductForm");
  const submitBtn = document.getElementById("submitBtn");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    submitBtn.disabled = true;

    try {
      const name = document.getElementById("name").value.trim();
      const price = parseFloat(document.getElementById("price").value);
      const description = document.getElementById("description").value.trim();
      const stock = parseInt(document.getElementById("stock").value, 10);
      const imageUrl = document.getElementById("imageUrl").value.trim();

      if (!name) throw new Error("Name required");
      if (!Number.isFinite(price) || price < 0) throw new Error("Invalid price");
      if (!description) throw new Error("Description required");
      if (!Number.isInteger(stock) || stock < 0) throw new Error("Invalid stock");
      if (!/^https?:\/\/.+\.(png|jpe?g|webp)$/i.test(imageUrl)) {
        throw new Error("Image URL must end with .png, .jpg, or .webp");
      }

      await addDoc(collection(db, "products"), {
        name,
        price,
        description,
        stock,
        imageUrl,
        active: true,
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp()
      });

      Swal.fire("✅ Success", "Product added successfully!", "success");
      form.reset();
    } catch(err) {
      console.error("Error adding product:", err);
      Swal.fire("❌ Error", err.message, "error");
    } finally {
      submitBtn.disabled = false;
    }
  });
</script>
